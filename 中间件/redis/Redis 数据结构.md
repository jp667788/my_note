### 数据类型
- String 字符串
- List	列表
- Hash	哈希
- Set	集合
- SortSet	有序集合
- bitmap
	- 统计用户登录天数
	- 活跃用户数


### 数据结构
- 简单动态字符串
- 双向链表
- 压缩列表
- 哈希表
- 跳表
- 整数数组


### 数据结构与数据类型对应关系
![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/note/2022-03-10-142241.jpg)

String 只有一种数据结构对应：简单动态字符串


List、Hash、Set、SortSet 每一种对应了两种数据结构

#### 字符串
- 读取的是字节流，
- 二进制安全 （超过ascII，直接存储十六进制）


### 常用命令
- string
	- get
	- set 
	- setnx setxx
	- getset
	- append
	- getrange start | start-end
		- 正向索引
		- 反向索引
	- setrange start | start-end
	- mset
		- 批量设置
	- mget
		- 批量获取
- bitmap
	- bitop

### 全局 Hash 表
- **Redis 使用一个哈希表来保存所有的键值对**
	- key 
		- String 
	- value 
		- 指向具体值的指针

- 优点
	- O(1) 的查询复杂度
- 缺点
	- 数据量变大 hash 冲突
	- 解决办法：
		- rehash

#### rehash
- 两个 hash 表：hash 表1，hash 表2。默认 hash 表1，hash 表2不分配空间
- hash 表2 分配更大的空间
- hash 表1数据拷贝到hash表2
- 释放hash表1


### redis 过期

#### 过期字典
过期时间统一保存在过期字典中：
- 过期字典的键是一个指针，指向某个键对象
- 过期字典值是一个 long long 类型的值，保存过期时间毫秒精度的时间戳

#### 过期判定
- 检查键是否存在在过期字典，如果存在，取出过期时间
- 判断当前系统的时间戳是否大于当前过期时间。

#### 过期键删除策略、
- 定时删除：设置键的同时，创建一个定时器 timer，到期自动删除
	- 优点
		- 内存友好，尽早可以释放过期的内存
	- 缺点
		- CPU 不友好，删除键过多时，占用过多 CPU 时间，影响吞吐
- 惰性删除（Redis 采用）：在每次获取该键的时候，判断是否过期，过期则删除该键。
	- 缺点
		- 内存不友好，很多过期对象占用内存空间
- 定期删除 （Redis 采用）：每隔一段时间就批量删除过期的键 
	- 优点
		- 兼顾内存和 CPU 
	- 缺点
		- 需要确定合适的删除频率
			- 删除太频繁，或删除时间过长，退化为定时删除
			- 删除太少，或删除时间太短，退化惰性删除，占用内存

#### AOF 、RDB 对过期键的处理
- RDB
	- 生成 RDB 
		- 已过期的不会保存到新创建的 RDB
	- 载入 RDB
		- 主库：检查是否过期，过期不会载入
		- 从库：全部载入。主从同步时会删除
- AOF
	- AOF 写入
		- 没有被删除前，不会对AOF 有影响
		- 被删除后：AOF 新增一条 delete 命令
	- AOF 重写
		- 会检查是否过期，过期则不会写入重写后的文件
- 复制
	- 主服务器删除过期键后，向从服务器发送 del 命令
	- 从服务器执行客户端读请求时，不会自动删除过期键。
	- 从服务器只有在接到主服务器的 del 命令才会删除过期键
	- 保证主从一致性


