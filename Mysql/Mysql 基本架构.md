## Mysql 的基本架构

- Server 层
	- 连接器
	- 查询缓存
	- 分析器
	- 优化器
	- 执行器
大多数核心服务功能，以及所有的内置函数、所有跨存储引擎的功能（存储过程、触发器、视图）都在 Server 层实现

- 存储引擎层

存储引擎层负责数据的存储和提取，Mysql 5.5.5 后默认为InnoDB 引擎。

![](https://tva1.sinaimg.cn/large/008i3skNgy1gt87a7qcvaj31400u0whj.jpg)


所有的存储引擎都共用同一个 Server 层


### 连接器
连接器负责跟客户端建立连接（TCP握手）、获取权限、维持和管理连接。
建立连接之后，连接器开始认证身份：
- 密码错误， 返回 "Access denied for user" 错误
- 密码正确，查询权限表中该用户的权限
> 连接成功建立之后，即使修改了当前用户的权限，也只能在下次连接重新建立的时候生效。

wait_timeout 控制客户端长时间无操作自动断开的时间。


### 查询缓存

如果当前执行的这条 sql 在查询缓存中，会直接返回给客户端。如果不在缓存中，在这条 sql 执行完成后，会将这条 sql 的结果放入查询缓存。

> 大多数情况下，**不建议使用查询缓存**
>查询缓存的失效非常频繁，只要对这个表有更新操作，这条表上的所有查询缓存都会被清空。
>
>Mysql 8.0 删除了查询缓存模块

### 分析器
1. 词法分析
	识别语句里面的字符串分别是什么，代表什么
	
2. 语法分析
	判断语句是否符合语法规则，不对则返回 "You have an error in your SQL syntax"。
	
	
### 优化器
- 在表里有多个索引的时候，决定使用哪个索引
- 或者在一个语句有多表关联的时候，决定各个表的连接顺序

优化器会选择执行效率更高的方式

### 执行器
1. 判断是否拥有权限
2. 调用表对应的存储引擎的接口


## 执行顺序
1. 连接器：建立连接
2. 查询缓存：是否直接返回缓存
3. 分析器：分析 sql 语句
4. 优化器：选择索引、连表顺序
5. 执行器：执行 sql




