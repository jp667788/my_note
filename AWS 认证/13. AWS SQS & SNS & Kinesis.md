# SQS 

- 简单队列服务
- 吞吐量无限，队列中的数量也没有限制
- 停留时间有限：默认停留 ***4*** 天，最大 ***14*** 天
- 低延迟，发布和接收的时间 < 10ms
- 消息必须 < ***256 kb***
- 至少一次传递

## 消息生产

- 使用  SDK API
	- **SendMessage** 发送消息

## 消息消费

- 消费者一次可以接收多达 ***10*** 条消息
- 消费后删除
	- ***DeleteMessage*** 删除消息

## ASG 组合

- ASG 中的 EC2 集群负责消费
- ASG 可以根据队列长度指标进行缩放
	- 消息数，这是一个 CloudWatch 指标
- 也可以设置一个 CloudWatch 警报



- DeleteQueue - 删除QueueUrl所指定的队列，不管队列的内容如何。当你删除一个队列时，该队列中的任何消息都不再可用了
	- 当你删除一个队列时，删除过程最多需要60秒。你在这60秒内发送的涉及该队列的请求可能会成功
- RemovePermission - 撤销队列策略中符合指定Label参数的任何权限。
- PurgeQueue - 删除QueueURL参数所指定的队列中的信息。当你使用PurgeQueue动作时，你不能检索从队列中删除的任何消息。但是队列仍然存在。

## 安全性

- 加密
	- **使用 HTTPS API** 发动和生成消息，实现动态加密
	- 通过  **KMS** 密钥实现静态加密
	- **客户端加密**
- 访问控制
	- **IAM 策略** 控制对 SQS API 的访问

## 访问策略

- 允许跨账户访问
- 发布 S3 时间通知

## 消息可见性超时

- 当某个使用者轮询消息时，其他使用者将看不到该消息
- 在经过可见性超时之后, 如果消息尚未删除, 则消息将被放回队列中
- 此时其他消费者就能够消费消息
- 如果在消息可见性超时窗口内处理完消息的话，消息可能被消费两次
- 使用 ***ChangeMessageVisibility***  API 来获得更多时间，增加可见性

## 死信队列

- 处理失败或超时的消息会重新放入队列中
- 设置 ***MaximumReceives*** 阈值，超过阈值则放入死信队列
- 死信队列对于调试非常有用
- FIFO队列的死信队列也必须是FIFO队列
- 可以将死信队列中的消息重新发送源队列中

## 延迟队列

- 延迟发送消息，消费者不会立即看到他们
- 最多 ***15min*** 的延迟，默认 0 s 延迟
- 可以在队列级别进行设置

## 长轮询

- 当使用者向我们请求消息时, 如果队列为空, 它可以选择引用unquote wait for messages to arrive，这就是长轮询
- 减少 API 的调用、降低延迟
- 一旦消息达到队列，队列就会将其发送会使用者
- 长轮询时间可以设置在 ***1-20 s*** 之间， ***20 s*** 最好
- 长轮询比短轮询更适合

## 扩展客户端

- 发送大于 256 KB 的大型消息
- 使用 SQS 扩展客户端 的 Java 库
	- 将 S3 作为存储库
	- 队列中存放元数据

## 必须知道的  API

- ***Create Queue*** ：创建队列
	- 设置 message retention period 在队列中的保留时间
- ***Purge Queue*** ：删除队列中的全部消息
- ***Send Message*** (DelaySeconds)：发送消息
- ***MaxNumberOfMessages*** ：一次接收消息的最大数量
- ***ReceiveMessageWaitTimeSeconds*** ：消费者在队列中获得响应之前需要等待的时间，启动长轮询和更改消息可见性
- ***ChangeMessageVisibility*** ：更改消息超时


## FIFO 队列

- 先进先出，顺序保证
- 吞吐量有有限

### 重复数据删除

- 重复数据消除时间间隔为 5 min
- 基于内容的重复数据消除，SHA-256 计算消息体

### 消息分组

- 相同消息组 ID 的消息，会被同一个消费者，按顺序消费


#  SNS

- 发布/订阅 模型
- 事件生产者只向特定的 SNS 主题发送消息
- 事件接收者需要订阅主题
- 每个主题可以有 1200万以内的订阅者
- 帐户可以有 10万个主题

- 发送邮件
- 发送短信
- 发送通知
- 可以发送到指定的 HTTP 或 HTTPS 端点，


## 发布

- 主题发布 （使用 SDK）
	- 创建主题
	- 创建订阅
	- 发布主题
- 直接发布 （移动APP SDK）
	- 创建应用平台
	- 创建平台端点
	- 发布平台端点

## 安全性

- 加密
	- 有 SQS 一样的安全性
	- 默认具有动态加密
	- 客户端加密
- 访问控制
	- IAM

## SNS + SQS 扇出

- 您希望将一条消息发送到多个SQS队列
- 在 SNS 中推送一次
- 然后 SQS 队列订阅 SNS 主题


## FIFO 主题

- 可以获得和 SQS FIFO 相同的功能
- 吞吐量有限

## 消息过滤

- 一个基于 JSON 的策略，过滤发送给不同的 SNS 订阅者
- 默认没有订阅策略，接收所有消息


# Kinesis

- Kansas使实时收集､ 处理和分析流媒体数据变得很容易
- 实时数据可以是任何东西, 如应用程序日志, 指标, 网站, 点击流,物联网遥测数据
- 包含四个服务
	- Kinesis 数据流：捕获和存储数据
	- Kinesis 数据管道：将数据流加载到其他数据存储
	- Kinesis 数据分析：使用 SQL 语言或 Apache Flink 分析数据流
	- Kinesis 视频流
	- 