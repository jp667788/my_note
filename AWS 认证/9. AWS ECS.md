
# ECS 、EKS

- Amazon Elastic Container Service  弹性容器服务
- Amazon Elastic Kubernetes Service 亚马逊 Kubernetes 托管版本
- AWS Fargte Serverless 平台

# ECS 
## EC2 启动类型

- 简易启动类型
	- ECS  = Elastic Container Service
	- 在  AWS 运行  Docker = 在 ECS 集群上执行  ECS 任务
	- 必须自行配置和维护基础架构
- 目标启动类型
	- 不需要进行基础配置
	- 全部 Severless
	- 只需新建任务目标
	- 扩展只需新增任务


## EFS 数据卷

- 可直接挂载到 ECS 任务
- 可以运行任何启动模式
- FS 也是 Severless 
- S3 不能挂载到 ECS 任务上


##  ECS 自动伸缩

- 可以手动增加服务中ECS任务的数量
- AWS  ECS 的自动伸缩根据多个指标
	- 根据ECS服务的CPU利用率进行缩放
	- 根据内存利用率（即ECS服务的RAM）进行缩放
	- 根据每个目标的ALB请求计数

- 自动缩放的不同类型
	- 目标追踪
	- 步进伸缩
	- 计划伸缩
>  ECS 服务级别的伸缩并不是对 ECS 集群的伸缩

- 自动伸缩组
	- 如果是 EC2 启动，可以使用自动伸缩组进行自动伸缩
	- 根据CPU利用率等因素来扩展ASG
- ECS Cluster Capacity Provider
	- 一旦您缺乏启动新任务的能力，它就会自动扩展您的ASG
	- 如果缺少RAM或CPU，则会创建EC2实例


##  ECS 滚动更新

- 最小正常百分比
	- 发布时，会先停止到最小正常百分比数量的旧实例
	- 启动新版本实例
- 最大正常百分比
	- 启动新版本实例后总数量达到最大正常百分比
	- 删除其他旧版本实例
	- 启动剩余新版本实例

## 任务定义

-  IAM 角色根据任务定义分配
- 一个任务定义一个 IAM 角色


##  ECS 任务布置

- 当您创建EC2类型的任务时, ECS必须根据目标EC2实例上的可用内存､ CPU和端口来确定将任务放置在何处
- 定义任务放置策略和任务放置约束，决定在何处添加新容器或从何处删除容器
- 只适用于 EC2 启动，不适用于 Fargate


- 当任务创建时：
	- 它将识别满足任务定义中的CPU､ 内存和端口要求的实例
	- 然后它会看一下任务安排的限制
	- 尝试识别出最符合任务放置策略的实例

### 任务布置策略

- binpack
	- 根据最少的可用CPU或内存量来放置任务
	- 它无法在一个EC2实例上放置更多容器时，会在另一个EC2实例上放置EC2容器
	- 最节省成本的策略
- Random
	- 随机放置
- Spread
	- 平均分配到不同可用区
	- 最大化高可用性

> 不同策略可以混合


### 任务布置约束

- distinctInstance：每个任务都应放置在不同的容器实例上
- memberOf ：任务放在满足表达式的实例


#  ECR

- Elastic Container Registry
- 用于存储和管理AWS上的Docker映像
- 看到存储Docker图像认为ECR,

# Copilot

- 它是一个命令行界面工具, 将用于构建、发布和操作生产就绪的容器化应用程序
- 它可以帮助您专注于构建应用程序，而不是设置基础架构，并且基础架构的所有复杂性


# Amazon EKS

- 亚马逊弹性Kubernetes服务
- 用于自动部署､ 扩展和管理容器化的应用程序
- 它是ECS的替代方案
- 同样支持两种启动模式
	- EC2 实例启动模式
	- Fargete 模式


- EKS中存在的不同节点类型
	- 节点组管理
		- 支持按需和现场实例
		- 由EKS服务本身管理
	- 自我管理节点
		- 创建节点
		- 注册到EKS集群, 然后将自己的节点作为ASG的一部分进行管理
	- AWS Fargate
		- 无节点

