


# Cognito 

- 它的目标是给用户一个身份来与Web和移动应用程序交互
- 这些用户通常不在我们的AWS账户之内
- Cognito中有两种子服务:
	- Cognito用户池：为应用程序用户提供了登录功能
	- Cognito身份池（联合身份）：为注册到我们应用程序的用户提供临时AWS凭据


# Cognito 用户池 CUP

- 这是一种为web和移动的应用程序用户创建无服务器数据库的方法
- 意味着用户可以使用简单的登录､ 用户名或电子邮件以及密码组合来连接到应用程序
- 重置密码
- 进行电子邮件和电话号码验证
- MFA


- 用户池拥有自己的内部用户数据库
- CUP与API网关和应用负载均衡器进行了集成


# lambda 触发器

- CUP 可以执行以下 lambda 触发器

![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/2023-05-24-134616.png)



# 身份验证托管UI

- 以重用Cognito为我们创建的UI, 并使用它来处理注册和登录工作流

# 自定义域名

- 必须使用 HTTPS 
- 证书必须是 ACM
- 地区必须是 us-east-1


# 自适应身份验证

- 可以阻止可疑登录或者要求进行多因素身份验证
- Cognito会检查每次登录尝试
- 然后根据恶意攻击者或未知登录发出登录请求的可能性, 将其分为低､ 中或高风险评分

# 令牌

- 当使用Cognito用户池登录时，从池中返回的是JWT令牌或JSON Web令牌都是 Base64 编码的
- 用户收到 header、payload、Signature 

# ALB 验证身份

- 可以将Cognito与负载均衡器集成来验证用户身份
	- 第一种是使用OpenID Connect的身份提供者
	- 使用Cognito用户池
	- 必须设置 HTTPS 监听
- 用户未经身份验证
	- 默认，提示请验证
	- 完全拒绝请求
	- 完全允许请求


# Cognito身份池 （联合身份）

- 我们的用户在AWS环境之外，但希望访问AWS环境中的内容，需要临时AWS凭据
- 因此, 我们无法为这些用户创建正常的IAM用户
- 通过Cognito身份池为这些用户给予访问AWS的权限
- 一旦用户获得这些AWS凭据，就可以通过使用SDK的API调用或通过API网关直接访问AWS服务


## IAM 橘色 

- 为经过身份验证的用户和访客用户定义一个默认的IAM角色
- 还可以定义规则, 根据用户ID选择哪个角色属于哪个用户
- 可以自定义IAM策略, 这要归功于使用策略变量


# 用户池 vs 身份池

- Cognito用户池
	- 用于身份验证
	- 是一个用户数据库
	- 可以使用登录联合
	- 可以定制用于身份验证的托管UI
	- 与Lambda集成
- 身份池
	- 用于授权或访问控制，这是AWS内部的访问控制

- Cognito User Pools + Cognito Identity = 身份认证 + 授权
- 


# Cognito Sync

Cognito Sync是一个AWS服务和客户端库，可以实现应用程序相关用户数据的跨设备同步。你可以用它来跨移动设备和网络同步用户资料数据，而不需要你自己的后台。客户端库在本地缓存数据，因此你的应用程序可以读取和写入数据，无论设备连接状态如何。当设备在线时，你可以同步数据，如果你设置了推送同步，可以立即通知其他设备有更新。

