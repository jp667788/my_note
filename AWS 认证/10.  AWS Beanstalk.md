
# Beanstalk

- Beanstalk提供了一个以开发人员为中心的视图来部署AWS上的应用程序
- 它将是一个托管服务, 将为您部署所有服务
- 处理配置､ 负载平衡器､扩展､ 应用程序健康监视､ 实例配置

## 部署选项

- 一次性部署 
	- 一次完成所有部署
	- 最快
	- 应用会停机
- 滚动部署
	- 一次更新几个实例
- 按批次滚动
- 一起部署新实例
	- 在一切正常时将所有实例刷出
- 蓝绿部署
	- 创建一个全新的环境，然后你切换到准备好了
- 金丝雀测试（灰度发布）
	- 将一小部分应用程序流量发送到一个全新的部署

![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/2023-05-18-080959.png)


## 生命周期策略

- Beanstalk 最多存储 1000个应用版本
- 不删除旧版本将无法继续部署
- 需要逐步淘汰旧的应用程序版本

- 生命周期策略需要手动触发
- 两种类型
	- 基于空间
	- 基于时间


## 扩展

- 我们创建一个zip文件时，它包含必须部署到Elastic Beanstalk的代码，但我们也可以添加EB扩展
- 在UI中设置的所有参数也可以通过代码和文件进行配置
- 要求
	- 所有配置文件必须在源代码的根目录下的ebextensions/目录
	- 必须是YAML或JSON格式
	- 扩展名必须是 .config
	- 可以使用 options_settings 修改默认配置
- 如果环境消失，EB扩展管理的任何内容都会被删除


## 底层原理

- Beanstalk的底层依赖于CloudFormation
- CloudFormation用于配置其他AWS服务, 因此我们的基础架构是代码

## 克隆

- 允许您将现有环境克隆到新环境中, 并且它将具有完全相同的配置
- 所有的资源和原始环境的配置被保留：
	- 包括负载均衡器类型和配置
	- RDS数据库类型、配置，但是不保留数据
	- 环境变量

## 迁移

- 负载均衡器：在创建Beanstalk环境后, 您无法更改弹性负载平衡器类型
- 如果需要更改负载均衡器类型，需要进行迁移
- 手动重新创建相同的配置 （克隆会复制负载均衡器的配置）
- 再将旧环境复制（而不是克隆）到新环境中


## 弹性 Beanstalk

- 首先，我们将创建RDS数据库的快照
- 转到RDS控制台并保护RDS数据库不被删除
- 

