
### 发布 - 订阅模型
#### 队列模型
- 多个生产者往同一个队列发送消息
- 消息的顺序就是生产者发送的自然顺序
- 多个消费者同时接收同一个队列时为竞争关系
- 如果同一份消息需要多个消费者消费，只能给每一个消费者创建一个单独的队列
	- 浪费资源
	- 生产者必须知道多少消费者，违背了 “解耦” 原则

![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/note/2022-03-22-140001.jpg)

#### 发布订阅模型
- 消息发送方：发布者（Publisher）
- 消息接收方：订阅者（Subscriber）
- 存放消息的容器称为：主题（Topic）

- 发布者将信息发送到主题中，订阅者先“订阅主题”，每份订阅中，订阅这都可以接收到主题的所有消息


![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/note/2022-03-22-140444.jpg)

### Rocket MQ 消息模型
- 基于发布 - 订阅模型
- 每个主题包含多个队列，通过多个队列实现多实例并行生产和消费
	- RocketMQ 只在队列上保证消息有序性，主题上无法保证严格有序
		- 每个主题包含多个队列，可以实现并行生产和消费（同一条消息只会存在于一个队列中，而不是同一条消息同时存在于多个队列中）。 在同一个队列中，消息是有序的，但由于是并行消费，topic在消费时并不保证消息严格有序。

- 订阅者
	- 消费组 （Consumer Group）
		- 每个消费组中多个消费者，竞争关系
		- 每个消费组都有消费主题中一份完整的消费
		- 不同消费组之间消费进度不受影响
		- 同一份被多个消费组消费

- Consumer Offset 
	- 消息需要被不同的组消费，消息完的消息不会被立即销毁
	- offset 之前的消息都被消费过，之后的消息都没消费国
	- 没成功消费一条消息 offset  +1

![](https://mynoteimage.oss-cn-beijing.aliyuncs.com/note/2022-03-22-142103.jpg)
 
 
 ### kafka 的消息模型
- kafka 消息模型与 RocketMQ 完全一致
- kafka 中，队列称为分区（Partition）